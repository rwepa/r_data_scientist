---
title: "Rå…¥é–€å¯¦ä½œç­å°ˆé¡Œå ±å‘Š-æ—¥ç©ºæ°£å“è³ªæŒ‡æ¨™(AQI)ä¹‹ç ”ç©¶"
author: "ææ˜æ˜Œ"
date: "2024-09-28"
header-includes:
  - \usepackage{ctex}
output:
  word_document: 
    toc: true
    toc_depth: 2
  pdf_document: 
    latex_engine: xelatex
    toc: true
    toc_depth: 2
  html_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\newpage

# 1.å•†æ¥­ç†è§£

ç ”ç©¶ç›®çš„ï¼šæ¢è¨æ—¥ç©ºæ°£å“è³ªæŒ‡æ¨™(AQI)åœ¨ä¸åŒåœ°å€æ˜¯å¦æœ‰å·®ç•°

è³‡æ–™ä¾†æºï¼šæ”¿åºœè³‡æ–™é–‹æ”¾å¹³å°-æ—¥ç©ºæ°£å“è³ªæŒ‡æ¨™(AQI)

è³‡æ–™åç¨±ï¼šaqx_p_434.csv

è³‡æ–™ç¶²å€ï¼š<https://data.gov.tw/dataset/40507>

å ±å‘Šåç¨±ï¼š00_ææ˜æ˜Œ_aqi.Rmd

\newpage

# 2.è³‡æ–™ç†è§£

è³‡æ–™ç†è§£åŒ…æ‹¬ä»¥ä¸‹ä¸»é¡Œï¼Œæœ¬ç ”ç©¶ä½¿ç”¨å…è²»è»Ÿé«”Rï¼ˆR Core Team ï¼Œ2024ï¼‰ä¸¦åƒè€ƒRWEPAç¶²ç«™è³‡æ–™ï¼ˆLeeï¼Œ2024ï¼‰ã€‚

-   è³‡æ–™åŒ¯å…¥

-   æ‘˜è¦

-   æ•˜è¿°æ€§çµ±è¨ˆåˆ†æ

-   è³‡æ–™è¦–è¦ºåŒ–

-   è³‡æ–™æ¸…é™¤

-   åˆä½µ

-   ç‰¹å¾µé¸æ“‡

-   è³‡æ–™è½‰æ›

**æ³¨æ„**

æœ¬ç ”ç©¶ç‚ºè§£æ±ºè½‰æ›PDFç¹ªåœ–çš„æ¨™é¡Œæ²’æœ‰é¡¯ç¤ºä¸­æ–‡å­—å‹å•é¡Œï¼Œä½¿ç”¨ showtext å¥—ä»¶ã€‚

åƒè€ƒï¼š<https://github.com/rwepa/ipas_bda/blob/main/ipas-r-program.R#L1348>

```{r chinese_font}
library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google(name = "Noto Sans TC", family = "twn")
showtext_auto()
```

**è³‡æ–™åŒ¯å…¥**

æœ¬ç ”ç©¶ä¸‹è¼‰æ”¿åºœè³‡æ–™é–‹æ”¾å¹³å°-æ—¥ç©ºæ°£å“è³ªæŒ‡æ¨™ï¼ˆAQIï¼‰ï¼Œä¸‹è¼‰ç•«é¢åƒè€ƒä¸‹åœ–æ‰€ç¤ºã€‚

```{r aqi, fig.cap="åœ–1 æ—¥ç©ºæ°£å“è³ªæŒ‡æ¨™(AQI)ä¸‹è¼‰åœ–", out.width="80%", echo=FALSE, eval=TRUE}
knitr::include_graphics("fig_1_aqi.png")
```

ä½¿ç”¨ `read.table` åŒ¯å…¥ aqx_p_434.csv æª”æ¡ˆã€‚åŒ¯å…¥è³‡æ–™åç¨±ç‚º`aq`ï¼Œè³‡æ–™ç­†æ•¸ç‚º1000ç­†ï¼Œæ¬„ä½ç‚º11å€‹ã€‚

```{r import_data}

# å–å¾—ç›®å‰å·¥ä½œç›®éŒ„
getwd()

# é¡¯ç¤ºæª”æ¡ˆæ¸…å–®
dir()

# åŒ¯å…¥è³‡æ–™
myfile <- "aqx_p_434.csv"
aq <- read.table(myfile, header=TRUE, sep=",")
```

**è³‡æ–™æ‘˜è¦**

ä½¿ç”¨`head`æª¢è¦–å‰6ç­†è³‡æ–™ã€‚ä½¿ç”¨`names`é¡¯ç¤ºæ‰€æœ‰æ¬„ä½åç¨±ã€‚ä½¿ç”¨`str`ç†è§£è³‡æ–™çµæ§‹ï¼Œå…¶ä¸­aqç‚ºè³‡æ–™æ¡†ï¼ˆdata.frameï¼‰ç‰©ä»¶ï¼Œè³‡æ–™ç­†æ•¸æœ‰`r nrow(aq)`ç­†èˆ‡`r ncol(aq)`å€‹æ¬„ä½ã€‚æœ€å¾Œä½¿ç”¨ `summary` ç†è§£è³‡æ–™æ–™æ‘˜è¦ï¼Œå…¶ä¸­ o38subindexèˆ‡ pm25subindex äºŒå€‹æ¬„ä½åŒ…æ‹¬éºæ¼å€¼ï¼ˆNAï¼‰ã€‚

```{r}
# æª¢è¦–å‰6ç­†è³‡æ–™
head(aq)

# æ¬„ä½åç¨±
names(aq)

# è³‡æ–™çµæ§‹
str(aq)

# è³‡æ–™æ‘˜è¦
summary(aq)
```

**è³‡æ–™è™•ç†**

ä½¿ç”¨`as.Date`å°‡monitordateè®Šæ•¸ç”± chr è³‡æ–™å‹æ…‹è½‰æ›ç‚º Date è³‡æ–™å‹æ…‹ã€‚

```{r data_process}
# æ—¥æœŸ: å­—ä¸²(chr)ä¿®æ­£ç‚ºæ—¥æœŸ(Date)
aq$monitordate <- as.Date(aq$monitordate)
str(aq)

# è³‡æ–™è™•ç†
head(aq, n=3)
dim(aq) # 1000åˆ—11è¡Œ

# ç¯©é¸ æ¿æ©‹ è³‡æ–™
aqBanqiao<- aq[aq$sitename == "æ¿æ©‹",]

# ä¾ç…§ monitordate æ¬„ä½ç”±å°è‡³å¤§éå¢æ’åº
aqBanqiao <- aqBanqiao[order(aqBanqiao$monitordate),]

# ç¯©é¸ æ±æ­¢ è³‡æ–™
aqXizhi <- aq[aq$sitename == "æ±æ­¢",]

# ä¾ç…§ monitordate æ¬„ä½ç”±å°è‡³å¤§éå¢æ’åº
aqXizhi <- aqXizhi[order(aqXizhi$monitordate),]
```

**è³‡æ–™è¦–è¦ºåŒ–**

```{r plot}
# æ¿æ©‹æš¨æ±æ­¢AQIè¶¨å‹¢åœ–
plot(aqBanqiao$aqi, 
     type="b", 
     main = paste0(aq$monitordate[1], " AQI æ¿æ©‹vs.æ±æ­¢-åˆå§‹ç‰ˆ"))
lines(aqXizhi$aqi, col="red")
points(aqXizhi$aqi, col="red")

```

```{r plot_refine}
# å„ªåŒ–è¶¨å‹¢åœ–
# å®¢è£½åŒ–Yè»¸æœ€å°å€¼,æœ€å¤§å€¼
ymin <- min(aqBanqiao$aqi, aqXizhi$aqi) - 1
ymax <- max(aqBanqiao$aqi, aqXizhi$aqi) + 3

plot(aqBanqiao$aqi, 
     type = "b", 
     ylim = c(ymin, ymax), 
     main = paste0(aq$monitordate[1], " AQI æ¿æ©‹vs.æ±æ­¢-å„ªåŒ–ç‰ˆ"))
lines(aqXizhi$aqi, col="red")
points(aqXizhi$aqi, col="red")
legend("topleft", legend=c("æ¿æ©‹", "æ±æ­¢"), col=c(1,2), lty=1)
```

```{r plot_final}
# å„ªåŒ–è¶¨å‹¢åœ–-revised
plot(aqBanqiao$aqi, 
     type = "b", 
     ylim = c(ymin, ymax), 
     axes=FALSE,
     xlab = "æ—¥æœŸ",
     ylab = "AQI",
     main = paste0(aq$monitordate[1], " AQI æ¿æ©‹vs.æ±æ­¢-æœ€çµ‚ç‰ˆ"))
lines(aqXizhi$aqi, col="red")
points(aqXizhi$aqi, col="red")

# Add axis
# 1=below, 2=left, 3=above and 4=right
axis(side=1, at = 1:12, labels = aqBanqiao$monitordate)
axis(side=2, las = 2)

# åœ–ä¾‹
legend("topleft", legend=c("æ¿æ©‹", "æ±æ­¢"), col=c(1,2), lty=1)

# ç¶²æ ¼ç·š
grid()

# å¤–æ¡†ç·š
box()
```

\newpage

# 3.è³‡æ–™æº–å‚™

è³‡æ–™æº–å‚™ä¸»è¦å·¥ä½œæ˜¯å°‡è³‡æ–™éš¨æ©Ÿå€åˆ†ç‚ºäºŒå¤§é¡ï¼šè¨“ç·´é›†(train dataset), æ¸¬è©¦é›†(test dataset), æœ‰çš„æ¨¡å‹æœƒåŠ ä¸Šé©—è­‰é›†.

æœ¬ä¾‹å°‡é€²è¡ŒT-æª¢å®šï¼Œå› æ­¤æš«ç„¡é ˆå€åˆ†è¨“ç·´é›†èˆ‡æ¸¬è©¦é›†ã€‚

\newpage

# 4.æ¨¡å¼å»ºç«‹ (ä½¿ç”¨è¨“ç·´é›†)

æ¨¡å¼å»ºç«‹åŒ…æ‹¬æ¨è«–çµ±è¨ˆ,æ©Ÿå™¨å­¸ç¿’,æ·±åº¦å­¸ç¿’,ç”Ÿæˆå¼å­¸ç¿’ç­‰æ–¹æ³•.

æœ¬ç ”ç©¶æ¡ç”¨ T-æª¢å®šæ–¹å¼é€²è¡Œï¼Œç›®çš„æ˜¯æ¯”è¼ƒæ¿æ©‹èˆ‡æ±æ­¢å¹³å‡æ—¥AQIæ˜¯å¦ç›¸ç­‰ã€‚ç›¸é—œå‡è¨­æ¢ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š

-   `p-value = 0.05`

-   H<sub>0</sub>: å¹³å‡AQI_æ¿æ©‹ ç­‰æ–¼ å¹³å‡AQI_æ±æ­¢

-   H<sub>1</sub>: å¹³å‡AQI_æ¿æ©‹ ä¸ç­‰æ–¼ å¹³å‡AQI_æ±æ­¢

```{r not_pdf, echo=FALSE}
# H<sub>0</sub>: ğ<sub>æ¿æ©‹</sub> is equal to ğ<sub>æ±æ­¢</sub>
# H<sub>1</sub>: ğ<sub>æ¿æ©‹</sub> is not equal to ğ<sub>æ±æ­¢</sub>
```

```{r t_test}
# ä½¿ç”¨é›™å°¾ ï¼´æª¢å®š
aqi_ttest <- t.test(x = aqBanqiao$aqi, y = aqXizhi$aqi)
print(aqi_ttest)
print(aqi_ttest$p.value)
```

\newpage

# 5.è©•ä¼°èˆ‡æ¸¬è©¦ (ä½¿ç”¨æ¸¬è©¦é›†)

```{r t_test_evaluation}
# på€¼ > 0.05ï¼Œæ¥å—H0
ifelse(aqi_ttest$p.value > 0.05, "æ¥å—H0", "æ¥å—H1")
```

\newpage

# 6.ä½ˆç½²æ‡‰ç”¨èˆ‡çµè«–

æœ¬ç ”ç©¶é¡¯ç¤ºæ¿æ©‹çš„å¹³å‡AQIèˆ‡å¹³å‡æ±æ­¢çš„AQIæ²’æœ‰é¡¯è‘—å·®ç•°ï¼Œæœªä¾†ç ”ç©¶äº¦å¯è€ƒæ…®å…¶ä»–è§€æ¸¬ç«™çš„Tæª¢å®šæˆ–è®Šç•°æ•¸åˆ†æï¼ˆAnalysis of varianceï¼ŒANOVAï¼‰ã€‚

æœ¬ç ”ç©¶ä½¿ç”¨å¥—ä»¶èˆ‡å‡½æ•¸èˆ‡åŠŸèƒ½åƒè€ƒä¸‹è¡¨æ‰€ç¤ºã€‚

| å¥—ä»¶     | å‡½æ•¸                           | åŠŸèƒ½             |
|----------|--------------------------------|------------------|
| utils    | read.table                     | åŒ¯å…¥æ–‡å­—æª”       |
| showtext | font_add_google, showtext_auto | è™•ç†ä¸­æ–‡å­—å‹å•é¡Œ |
| getwd    | base                           | é¡¯ç¤ºæª”æ¡ˆæ¸…å–®     |
| utils    | head                           | é¡¯ç¤ºå‰6ç­†è³‡æ–™    |
| base     | names                          | æ¬„ä½åç¨±         |
| utils    | str                            | è³‡æ–™çµæ§‹         |
| base     | summary                        | è³‡æ–™æ‘˜è¦         |
| base     | as.Date                        | è½‰æ›ç‚ºæ—¥æœŸè³‡æ–™   |
| graphics | plot                           | ç¹ªåœ–             |
| graphics | lines                          | åŠ å…¥ç·š           |
| graphics | points                         | åŠ å…¥é»           |
| stats    | t.test                         | Tæª¢å®š            |

: æœ¬ç ”ç©¶ä½¿ç”¨å¥—ä»¶èˆ‡å‡½æ•¸è¡¨

\newpage

# åƒè€ƒæ–‡ç»

1.  Lee, Ming-Chang. (2024, September 26). RWEPA. <https://rwepa.blogspot.com/>

2.  R Core Team (2024). R: A Language and Environment for Statistical Computing. R Foundation for Statistical Computing, Vienna, Austria. <https://www.R-project.org/>.
